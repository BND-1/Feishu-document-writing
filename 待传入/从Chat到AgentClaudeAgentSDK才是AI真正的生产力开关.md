![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/onUpicncef3rDtTibZ29N2CPNicFSqhKBic6ETXvJvrCIkrnCvKfX09LKmtibQ0URhSjUPN084NEVeL6xic4tRqLxXqg/0?wx_fmt=jpeg)

#  ä» Chat åˆ° Agentï¼šClaude Agent SDK æ‰æ˜¯ AI çœŸæ­£çš„ç”Ÿäº§åŠ›å¼€å…³

å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡ Claude Code CLIï¼Œä¸€å®šä¼šè¢«å®ƒå¼ºå¤§çš„ä»£ç ç†è§£å’Œç¼–è¾‘èƒ½åŠ›æ‰€éœ‡æ’¼ã€‚ä½†ä½ æ˜¯å¦æƒ³è¿‡ï¼Œèƒ½ä¸èƒ½æŠŠè¿™ç§èƒ½åŠ›é›†æˆåˆ°è‡ªå·±çš„åº”ç”¨ä¸­ï¼Ÿèƒ½ä¸èƒ½è®© AI
æ™ºèƒ½ä½“åœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨ä¿®å¤ Bugï¼Ÿèƒ½ä¸èƒ½æ„å»ºä¸€ä¸ªå…¨è‡ªåŠ¨åŒ–çš„ä»£ç å®¡æŸ¥ç³»ç»Ÿï¼Ÿ  Claude Agent SDK
å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„ã€‚å®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä»¥ç¨‹åºåŒ–çš„æ–¹å¼ä½¿ç”¨ Claude çš„èƒ½åŠ›ï¼Œå°†äº¤äº’å¼çš„å¼€å‘ä½“éªŒè½¬åŒ–ä¸ºç”Ÿäº§çº§çš„è‡ªåŠ¨åŒ–å·¥å…·ã€‚  

##  > 01\.  Claude Agent SDK æ˜¯ä»€ä¹ˆï¼Ÿ

Claude Agent SDK æ˜¯ Anthropic å®˜æ–¹æä¾›çš„æ¡†æ¶ï¼Œç”¨äºæ„å»ºç”Ÿäº§çº§çš„ AI æ™ºèƒ½ä½“ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒè®©ä½ èƒ½å¤Ÿï¼š

â€¢ **ç¼–å†™è‡ªä¸»ä»£ç†** ï¼šè‡ªåŠ¨è¯»å–æ–‡ä»¶ã€è¿è¡Œå‘½ä»¤ã€æœç´¢ç½‘é¡µã€ç¼–è¾‘ä»£ç 

â€¢ **ç”Ÿäº§è‡ªåŠ¨åŒ–** ï¼šæ„å»º CI/CD æµç¨‹ã€ä»»åŠ¡è‡ªåŠ¨åŒ–ã€æ‰¹é‡å¤„ç†

â€¢ **åº”ç”¨é›†æˆ** ï¼šåµŒå…¥åˆ°ç°æœ‰åº”ç”¨æˆ– API ä¸­

â€¢ **è‡ªå®šä¹‰å·¥ä½œæµ** ï¼šé€šè¿‡ hooksã€æƒé™å’Œä¼šè¯ç®¡ç†å®ç°å¤æ‚åœºæ™¯

ä¸ Claude Code CLI çš„äº¤äº’å¼ä½“éªŒä¸åŒï¼ŒClaude Agent SDK æä¾›çš„æ˜¯å®Œå…¨å¯ç¼–ç¨‹çš„
APIï¼Œè®©ä½ èƒ½å¤Ÿåœ¨ä»£ç ä¸­ç²¾ç¡®æ§åˆ¶æ™ºèƒ½ä½“çš„æ¯ä¸€ä¸ªè¡Œä¸ºã€‚

###  æ ¸å¿ƒåŠŸèƒ½ä¸€è§ˆ

Claude Agent SDK æä¾›äº†ä¸°å¯Œçš„å†…ç½®å·¥å…·å’Œç‰¹æ€§ï¼š

**æ–‡ä»¶æ“ä½œï¼š** Read(è¯»æ–‡ä»¶)ã€Write(å†™æ–‡ä»¶)ã€Edit(ç¼–è¾‘æ–‡ä»¶)

**å‘½ä»¤æ‰§è¡Œï¼š** Bash(è¿è¡Œå‘½ä»¤)ã€åå°ä»»åŠ¡ç®¡ç†

**ä»£ç æœç´¢ï¼š** Glob(æ–‡ä»¶åŒ¹é…)ã€Grep(å†…å®¹æœç´¢)

**ç½‘ç»œåŠŸèƒ½ï¼š** WebSearch(ç½‘ç»œæœç´¢)ã€WebFetch(è·å–ç½‘é¡µ)

**é«˜çº§ç‰¹æ€§ï¼š** Hooks(æ‹¦æˆªå™¨)ã€æƒé™ç³»ç»Ÿã€ä¼šè¯ç®¡ç†ã€å­ä»£ç†ã€MCP é›†æˆ

##  > 02\.  å¿«é€Ÿå¼€å§‹ï¼š5 åˆ†é’Ÿåˆ›å»ºç¬¬ä¸€ä¸ªæ™ºèƒ½ä½“

###  ç¬¬ä¸€æ­¥ï¼šå®‰è£…

é¦–å…ˆå®‰è£… Claude Codeï¼ˆSDK çš„è¿è¡Œæ—¶ï¼‰ï¼š

# macOS/Linux/WSL  
curl -fsSL https://claude.ai/install.sh | bash   

# æˆ–è€…ä½¿ç”¨ Homebrew  
brew install --cask claude-code  

# æˆ–è€…ä½¿ç”¨ npm  
npm install -g @anthropic-ai/claude-code  
---  

ç„¶åå®‰è£… SDKï¼š

# Python  
pip install claude-agent-sdk  

# TypeScript/Node.js  
npm install @anthropic-ai/claude-agent-sdk  
---  

###  ç¬¬äºŒæ­¥ï¼šé…ç½® API å¯†é’¥

# è®¾ç½®ç¯å¢ƒå˜é‡  
export  ANTHROPIC_API_KEY=your-api-key  

# åœ¨ https://console.anthropic.com/ è·å– API å¯†é’¥  
---

###  ç¬¬ä¸‰æ­¥ï¼šç¼–å†™ç¬¬ä¸€ä¸ªæ™ºèƒ½ä½“

Python ç‰ˆæœ¬ï¼š

import  asyncio  
from  claude_agent_sdk  import  query, ClaudeAgentOptions  

async  def  main  ():  
async  for  message  in  query  (  
prompt=  "åˆ—å‡ºå½“å‰ç›®å½•çš„æ‰€æœ‰ Python æ–‡ä»¶"  ,  
options=  ClaudeAgentOptions  (  
allowed_tools=[  "Glob"  ,  "Read"  ],  
permission_mode=  "acceptEdits"  
)  
):  
if  hasattr  (message,  'content'  ):  
for  block  in  message.content:  
if  hasattr  (block,  'text'  ):  
print  (block.text)  

asyncio.  run  (main())  
---  

TypeScript ç‰ˆæœ¬ï¼š

import  { query }  from  "@anthropic-ai/claude-agent-sdk"  ;  

async  function  main  () {  
for  await  (  const  message  of  query  ({  
prompt:  "åˆ—å‡ºå½“å‰ç›®å½•çš„æ‰€æœ‰ Python æ–‡ä»¶"  ,  
options: {  
allowedTools: [  "Glob"  ,  "Read"  ],  
permissionMode:  "acceptEdits"  
}  
})) {  
if  (message.type ===  "assistant"  && message.message?.content) {  
for  (  const  block  of  message.message.content) {  
if  (  "text"  in  block) {  
console.  log  (block.text);  
}  
}  
}  
}  
}  

main().  catch  (console.error);  
---  

è¿è¡Œè¿™ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½ å°±åˆ›å»ºäº†ç¬¬ä¸€ä¸ªæ™ºèƒ½ä½“ï¼

##  > 03\.  æ ¸å¿ƒæ¦‚å¿µæ·±åº¦è§£æ

###  1\. æ™ºèƒ½ä½“æ‰§è¡Œå¾ªç¯

Claude Agent SDK å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„æ™ºèƒ½ä½“å†³ç­–å¾ªç¯ï¼š

ç”¨æˆ·æç¤º  
â†“  
Claude åˆ†æå¹¶å†³å®šä½¿ç”¨å“ªä¸ªå·¥å…·  
â†“  
SDK æ‰§è¡Œå·¥å…·ï¼ˆå†…ç½®å·¥å…·ç”± SDK è‡ªåŠ¨å¤„ç†ï¼‰  
â†“  
å°†æ‰§è¡Œç»“æœåé¦ˆç»™ Claude  
â†“  
Claude åˆ†æç»“æœå¹¶å†³å®šç»§ç»­æˆ–å®Œæˆ  
â†“  
è¿”å›æœ€ç»ˆç»“æœç»™ç”¨æˆ·  
---  

è¿™ä¸ªå¾ªç¯æ˜¯å®Œå…¨è‡ªä¸»çš„ï¼ŒClaude ä¼šæ ¹æ®ä»»åŠ¡éœ€æ±‚è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚

###  2\. å·¥å…·ç³»ç»Ÿæ¶æ„

SDK æä¾›äº†ä¸°å¯Œçš„å†…ç½®å·¥å…·ï¼š

**æ–‡ä»¶æ“ä½œå·¥å…·**

â€¢  Read  ï¼šè¯»å–ä»»ä½•æ ¼å¼çš„æ–‡ä»¶ï¼ˆæ”¯æŒå›¾ç‰‡ã€PDFã€Jupyter ç¬”è®°æœ¬ç­‰ï¼‰

â€¢  Write  ï¼šåˆ›å»ºæ–°æ–‡ä»¶

â€¢  Edit  ï¼šç²¾ç¡®ä¿®æ”¹ç°æœ‰æ–‡ä»¶çš„ç‰¹å®šéƒ¨åˆ†

**å‘½ä»¤æ‰§è¡Œå·¥å…·**

â€¢  Bash  ï¼šè¿è¡Œç»ˆç«¯å‘½ä»¤

â€¢  BashOutput  ï¼šè·å–åå°ä»»åŠ¡è¾“å‡º

â€¢  KillBash  ï¼šç»ˆæ­¢åå°è¿›ç¨‹

**æœç´¢å·¥å…·**

â€¢  Glob  ï¼šæ–‡ä»¶æ¨¡å¼åŒ¹é…ï¼ˆå¦‚  **/*.py  ï¼‰

â€¢  Grep  ï¼šåŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹æœç´¢

**ç½‘ç»œå·¥å…·**

â€¢  WebSearch  ï¼šç½‘ç»œæœç´¢ï¼ˆä»…é™ç¾å›½ï¼‰

â€¢  WebFetch  ï¼šè·å–ç½‘é¡µå†…å®¹

**é«˜çº§å·¥å…·**

â€¢  Task  ï¼šå§”æ´¾ç»™å­ä»£ç†å¤„ç†ç‰¹å®šä»»åŠ¡

â€¢  TodoWrite  ï¼šè·Ÿè¸ªä»»åŠ¡è¿›åº¦

###  3\. æƒé™ç³»ç»Ÿ

æƒé™ç³»ç»Ÿæ˜¯ Claude Agent SDK çš„æ ¸å¿ƒå®‰å…¨ç‰¹æ€§ã€‚å®ƒæŒ‰ç…§ä»¥ä¸‹ä¼˜å…ˆçº§è¿›è¡Œæ£€æŸ¥ï¼š

1\. PreToolUse Hookï¼ˆå‰ç½®æ‹¦æˆªï¼‰  
2\. Deny è§„åˆ™ï¼ˆæ‹’ç»ä¼˜å…ˆï¼‰  
3\. Allow è§„åˆ™ï¼ˆæ˜ç¡®å…è®¸ï¼‰  
4\. Ask è§„åˆ™ï¼ˆéœ€è¦ç¡®è®¤ï¼‰  
5\. æƒé™æ¨¡å¼æ£€æŸ¥  
6\. canUseTool å›è°ƒ  
7\. PostToolUse Hookï¼ˆåç½®å¤„ç†ï¼‰  
---  

ç¤ºä¾‹ï¼šå®ç°æ–‡ä»¶ä¿æŠ¤

async  def  protect_sensitive_files  (tool_name, input_data):  
"""ç¦æ­¢ä¿®æ”¹æ•æ„Ÿæ–‡ä»¶"""  
if  tool_name  in  [  "Write"  ,  "Edit"  ]:  
file_path = input_data.  get  (  "file_path"  ,  ""  )  
# ä¿æŠ¤ .env å’Œé…ç½®æ–‡ä»¶  
if  any  (pattern  in  file_path  for  pattern  in  [  ".env"  ,
"config.json"  ,  "secrets"  ]):  
return  {  
"behavior"  :  "deny"  ,  
"message"  :  "ä¸å…è®¸ä¿®æ”¹æ•æ„Ÿé…ç½®æ–‡ä»¶"  
}  
return  {  "behavior"  :  "allow"  ,  "updatedInput"  : input_data}  

async  for  message  in  query  (  
prompt=  "é‡æ„ä»£ç åº“"  ,  
options=  ClaudeAgentOptions  (  
allowed_tools=[  "Read"  ,  "Write"  ,  "Edit"  ],  
can_use_tool=protect_sensitive_files  
)  
):  
print  (message)  
---  

###  4\. Hooksï¼šæ‹¦æˆªå’Œæ‰©å±•

Hooks å…è®¸ä½ åœ¨å·¥å…·æ‰§è¡Œçš„å…³é”®ç‚¹æ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚æ”¯æŒçš„ Hook ç±»å‹ï¼š

â€¢  PreToolUse  ï¼šå·¥å…·æ‰§è¡Œå‰

â€¢  PostToolUse  ï¼šå·¥å…·æ‰§è¡Œå

â€¢  Stop  ï¼šæ™ºèƒ½ä½“åœæ­¢æ—¶

â€¢  PreUserPromptSubmit  ï¼šç”¨æˆ·è¾“å…¥æäº¤å‰

â€¢  PreAgentMessageSubmit  ï¼šæ™ºèƒ½ä½“æ¶ˆæ¯æäº¤å‰

ç¤ºä¾‹ï¼šå®ç°å®¡è®¡æ—¥å¿—

import  asyncio  
from  datetime  import  datetime  

async  def  audit_logger  (input_data, tool_use_id, context):  
"""è®°å½•æ‰€æœ‰æ–‡ä»¶ä¿®æ”¹æ“ä½œ"""  
tool_name = input_data.  get  (  'tool_name'  ,  'unknown'  )  
file_path = input_data.  get  (  'tool_input'  , {}).  get  (  'file_path'  ,
'unknown'  )  

with  open  (  './audit.log'  ,  'a'  )  as  f:  
timestamp = datetime.  now  ().  isoformat  ()  
f.  write  (  f"  {  timestamp  }  |  {  tool_name  }  |  {  file_path  }  \n"  )   

return  {}  

async  for  message  in  query  (  
prompt=  "é‡æ„èº«ä»½éªŒè¯æ¨¡å—"  ,  
options=  ClaudeAgentOptions  (  
allowed_tools=[  "Read"  ,  "Edit"  ],  
permission_mode=  "acceptEdits"  ,  
hooks={  
"PostToolUse"  : [  
HookMatcher  (  
matcher=  "Edit|Write"  ,  # åªç›‘æ§ä¿®æ”¹æ“ä½œ  
hooks=[audit_logger]  
)  
]  
}  
)  
):  
print  (message)  
---  

###  5\. ä¼šè¯ç®¡ç†

ä¼šè¯ç®¡ç†è®©ä½ èƒ½å¤Ÿç»´æŠ¤æŒç»­çš„å¯¹è¯ä¸Šä¸‹æ–‡ï¼š

async  def  continuous_conversation  ():  
# ç¬¬ä¸€æ¬¡æŸ¥è¯¢  
session_id =  None  
async  for  message  in  query  (  
prompt=  "è¯»å– authentication.py æ–‡ä»¶"  ,  
options=  ClaudeAgentOptions  (allowed_tools=[  "Read"  ])  
):  
if  hasattr  (message,  'subtype'  )  and  message.subtype ==  'init'  :  
session_id = message.session_id  

# æ¢å¤ä¼šè¯ï¼ŒClaude è®°å¾—ä¹‹å‰è¯»å–çš„å†…å®¹  
if  session_id:  
async  for  message  in  query  (  
prompt=  "æ‰¾å‡ºæ‰€æœ‰è°ƒç”¨è¿™ä¸ªæ–‡ä»¶çš„åœ°æ–¹"  ,  # Claude çŸ¥é“"è¿™ä¸ªæ–‡ä»¶"æ˜¯ä»€ä¹ˆ  
options=  ClaudeAgentOptions  (resume=session_id)  
):  
print  (message)  
---  

è¿˜å¯ä»¥åˆ†å‰ä¼šè¯è¿›è¡Œå®éªŒï¼š

# åˆ›å»ºä¼šè¯åˆ†æ”¯ï¼Œä¸å½±å“åŸä¼šè¯  
async  for  message  in  query  (  
prompt=  "å°è¯•å¦ä¸€ç§é‡æ„æ–¹æ¡ˆ"  ,  
options=  ClaudeAgentOptions  (  
resume=session_id,  
fork_session=  True  # åˆ›å»ºæ–°åˆ†æ”¯  
)  
):  
print  (message)  
---  

##  > 04\.  å®æˆ˜åœºæ™¯

###  åœºæ™¯ 1ï¼šè‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥

async  def  code_review_agent  ():  
"""å®Œæ•´çš„ä»£ç å®¡æŸ¥æ™ºèƒ½ä½“"""  
async  for  message  in  query  (  
prompt=  """  
å¯¹æ•´ä¸ªä»£ç åº“è¿›è¡Œå…¨é¢å®¡æŸ¥ï¼š  
1\. æŸ¥æ‰¾å®‰å…¨æ¼æ´ï¼ˆSQL æ³¨å…¥ã€XSSã€CSRF ç­‰ï¼‰  
2\. è¯†åˆ«æ€§èƒ½é—®é¢˜ï¼ˆN+1 æŸ¥è¯¢ã€å†…å­˜æ³„æ¼ç­‰ï¼‰  
3\. æ£€æŸ¥ä»£ç é£æ ¼ä¸€è‡´æ€§  
4\. ç”Ÿæˆè¯¦ç»†çš„å®¡æŸ¥æŠ¥å‘Š  
"""  ,  
options=  ClaudeAgentOptions  (  
allowed_tools=[  "Read"  ,  "Glob"  ,  "Grep"  ],  
system_prompt=  "ä½ æ˜¯ä¸€ä½èµ„æ·±ä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œä¸“æ³¨äºå®‰å…¨æ€§å’Œæ€§èƒ½ä¼˜åŒ–"  
)  
):  
if  hasattr  (message,  'content'  ):  
for  block  in  message.content:  
if  hasattr  (block,  'text'  ):  
print  (block.text)  
---  

###  åœºæ™¯ 2ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å’Œä¿®å¤

async  def  auto_test_fix  ():  
"""è‡ªåŠ¨ç¼–å†™æµ‹è¯•å¹¶ä¿®å¤å¤±è´¥"""  
async  for  message  in  query  (  
prompt=  """  
ä¸º utils.py ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼š  
1\. åˆ†æå‡½æ•°é€»è¾‘  
2\. ç¼–å†™æµ‹è¯•ç”¨ä¾‹  
3\. è¿è¡Œæµ‹è¯•  
4\. å¦‚æœæœ‰å¤±è´¥ï¼Œåˆ†æåŸå› å¹¶ä¿®å¤  
5\. é‡æ–°è¿è¡Œç¡®ä¿å…¨éƒ¨é€šè¿‡  
"""  ,  
options=  ClaudeAgentOptions  (  
allowed_tools=[  "Read"  ,  "Write"  ,  "Edit"  ,  "Bash"  ,  "Glob"  ],  
permission_mode=  "acceptEdits"  
)  
):  
print  (message)  
---  

###  åœºæ™¯ 3ï¼šè‡ªå®šä¹‰ MCP å·¥å…·

MCPï¼ˆModel Context Protocolï¼‰å…è®¸ä½ åˆ›å»ºè‡ªå®šä¹‰å·¥å…·ï¼š

from  claude_agent_sdk  import  tool, create_sdk_mcp_server  

@tool  (  "calculate"  ,  "æ‰§è¡Œæ•°å­¦è¿ç®—"  , {  "expression"  :  str  })  
async  def  calculate  (args):  
"""è‡ªå®šä¹‰è®¡ç®—å™¨å·¥å…·"""  
try  :  
# å®‰å…¨åœ°è¯„ä¼°æ•°å­¦è¡¨è¾¾å¼  
result =  eval  (args[  "expression"  ], {  "__builtins__"  : {}})  
return  {  
"content"  : [{  "type"  :  "text"  ,  "text"  :  f"è®¡ç®—ç»“æœï¼š  {  result  }  "  }]  
}  
except  Exception  as  e:  
return  {  
"content"  : [{  "type"  :  "text"  ,  "text"  :  f"è®¡ç®—é”™è¯¯ï¼š  {  str  (e)  }  "
}],  
"is_error"  :  True  
}  

# åˆ›å»º MCP æœåŠ¡å™¨  
calculator_server = create_sdk_mcp_server(  
name=  "calculator"  ,  
version=  "1.0.0"  ,  
tools=[calculate]  
)  

# åœ¨æ™ºèƒ½ä½“ä¸­ä½¿ç”¨  
async  for  message  in  query  (  
prompt=  "è®¡ç®— 123 * 456 + 789"  ,  
options=  ClaudeAgentOptions  (  
mcp_servers={  "calc"  : calculator_server},  
allowed_tools=[  "mcp__calc__calculate"  ]  
)  
):  
print  (message)  
---  

###  åœºæ™¯ 4ï¼šå­ä»£ç†å§”æ´¾

å°†å¤æ‚ä»»åŠ¡åˆ†è§£ç»™ä¸“é—¨çš„å­ä»£ç†ï¼š

async  def  subagent_delegation  ():  
"""ä½¿ç”¨ä¸“é—¨çš„ä»£ç å®¡æŸ¥å­ä»£ç†"""  
async  for  message  in  query  (  
prompt=  "ä½¿ç”¨ä»£ç å®¡æŸ¥ä»£ç†æ£€æŸ¥æ•´ä¸ªä»£ç åº“"  ,  
options=  ClaudeAgentOptions  (  
allowed_tools=[  "Read"  ,  "Glob"  ,  "Grep"  ,  "Task"  ],  
agents={  
"code-reviewer"  :  AgentDefinition  (  
description=  "ä¸“ä¸šä»£ç å®¡æŸ¥ä¸“å®¶"  ,  
prompt=  "åˆ†æä»£ç è´¨é‡å¹¶æå‡ºæ”¹è¿›å»ºè®®"  ,  
tools=[  "Read"  ,  "Glob"  ,  "Grep"  ]  
)  
}  
)  
):  
print  (message)  
---  

##  > 05\.  æœ€ä½³å®è·µ

###  1\. æœ€å°åŒ–æƒé™åŸåˆ™

# âœ… å¥½çš„åšæ³•ï¼šåªæˆäºˆå¿…è¦çš„æƒé™  
options =  ClaudeAgentOptions  (  
allowed_tools=[  "Read"  ,  "Glob"  ],  # åªè¯»æ“ä½œ  
permission_mode=  "default"  
)  

# âŒ é¿å…ï¼šè¿‡åº¦æˆæƒ  
options =  ClaudeAgentOptions  (  
permission_mode=  "bypassPermissions"  # ä»…åœ¨å®Œå…¨å¯ä¿¡ç¯å¢ƒä¸­ä½¿ç”¨  
)  
---  

###  2\. å®ç°åˆ†å±‚æƒé™æ£€æŸ¥

async  def  layered_security  (tool_name, input_data):  
"""å¤šå±‚å®‰å…¨æ£€æŸ¥"""  
if  tool_name ==  "Bash"  :  
cmd = input_data.  get  (  "command"  ,  ""  )  

# é»‘åå•ï¼šå±é™©å‘½ä»¤  
dangerous_patterns = [  "rm -rf /"  ,  "sudo"  ,  "dd if="  ,  "mkfs"  ]  
if  any  (pattern  in  cmd  for  pattern  in  dangerous_patterns):  
return  {  "behavior"  :  "deny"  ,  "message"  :  "æ£€æµ‹åˆ°å±é™©å‘½ä»¤"  }  

# ç™½åå•ï¼šä»…å…è®¸ç‰¹å®šå‘½ä»¤  
allowed_commands = [  "git"  ,  "npm"  ,  "pytest"  ,  "ls"  ,  "cat"  ]  
if  not  any  (cmd.  startswith  (allowed)  for  allowed  in
allowed_commands):  
return  {  "behavior"  :  "ask"  ,  "message"  :  f"æ˜¯å¦å…è®¸æ‰§è¡Œï¼š  {  cmd  }  "  }  

return  {  "behavior"  :  "allow"  ,  "updatedInput"  : input_data}  
---  

###  3\. é”™è¯¯å¤„ç†

from  claude_agent_sdk  import  (  
CLINotFoundError,  
ProcessError,  
CLIJSONDecodeError  
)  

try  :  
async  for  message  in  query  (prompt=  "æ‰§è¡Œä»»åŠ¡"  ):  
process_message  (message)  
except  CLINotFoundError:  
print  (  "è¯·å…ˆå®‰è£… Claude Codeï¼šnpm install -g @anthropic-ai/claude-code"  )  
except  ProcessError  as  e:  
print  (  f"è¿›ç¨‹å¤±è´¥ï¼Œé€€å‡ºç ï¼š  {  e.exit_code  }  "  )  
print  (  f"é”™è¯¯ä¿¡æ¯ï¼š  {  e  }  "  )  
except  CLIJSONDecodeError  as  e:  
print  (  f"JSON è§£æé”™è¯¯ï¼š  {  e  }  "  )  
except  Exception  as  e:  
print  (  f"æœªé¢„æœŸçš„é”™è¯¯ï¼š  {  e  }  "  )  
---  

###  4\. æ€§èƒ½ä¼˜åŒ–

# âœ… è®¾ç½®åˆç†çš„æœ€å¤§è½®æ¬¡  
options =  ClaudeAgentOptions  (  
max_turns=  10  # é˜²æ­¢æ— é™å¾ªç¯  
)  

# âœ… é™åˆ¶å·¥å…·é›†åˆ  
options =  ClaudeAgentOptions  (  
allowed_tools=[  "Read"  ,  "Grep"  ]  # æ¯”å…è®¸æ‰€æœ‰å·¥å…·æ›´å¿«  
)  

# âœ… åœ¨ CI/CD ä¸­è·³è¿‡æƒé™æ£€æŸ¥  
options =  ClaudeAgentOptions  (  
permission_mode=  "bypassPermissions"  ,  # ä»…åœ¨å¯ä¿¡ç¯å¢ƒ  
allowed_tools=[  "Read"  ,  "Write"  ,  "Edit"  ,  "Bash"  ]  
)  
---  

###  5\. å®‰å…¨æ³¨æ„äº‹é¡¹

# âœ… é™åˆ¶æ–‡ä»¶è®¿é—®èŒƒå›´  
options =  ClaudeAgentOptions  (  
add_dirs=[  "/safe/project/directory"  ],  # ä»…å…è®¸ç‰¹å®šç›®å½•  
cwd=  "/safe/project/directory"  
)  

# âœ… æ©ç›–æ—¥å¿—ä¸­çš„æ•æ„Ÿä¿¡æ¯  
def  sanitize_log  (message):  
"""æ¸…ç†æ•æ„Ÿä¿¡æ¯"""  
sensitive_patterns = [  "password"  ,  "api_key"  ,  "token"  ,  "secret"  ]  
sanitized =  str  (message)  
for  pattern  in  sensitive_patterns:  
if  pattern  in  sanitized.  lower  ():  
sanitized = sanitized.  replace  (pattern,  "***"  )  
return  sanitized  

# åœ¨è®°å½•æ—¥å¿—æ—¶ä½¿ç”¨  
logging.  info  (  sanitize_log  (message))  
---  

##  > 06\.  Claude Agent SDK vs Claude Code CLI

ä¸¤è€…æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿä½•æ—¶ä½¿ç”¨å“ªä¸ªï¼Ÿ

###  æ ¸å¿ƒåŒºåˆ«

**ä½¿ç”¨æ–¹å¼ï¼š**  
â€¢ Claude Code CLIï¼šäº¤äº’å¼å‘½ä»¤è¡Œ  
â€¢ Claude Agent SDKï¼šç¨‹åºåŒ– API

**ä¸»è¦åœºæ™¯ï¼š**  
â€¢ Claude Code CLIï¼šå¼€å‘è°ƒè¯•ã€ä¸€æ¬¡æ€§ä»»åŠ¡  
â€¢ Claude Agent SDKï¼šç”Ÿäº§è‡ªåŠ¨åŒ–ã€CI/CD

**æƒé™ç®¡ç†ï¼š**  
â€¢ Claude Code CLIï¼šUI æç¤ºæˆ–é…ç½®æ–‡ä»¶  
â€¢ Claude Agent SDKï¼šä»£ç çº§æ§åˆ¶

**ä¼šè¯ç®¡ç†ï¼š**  
â€¢ Claude Code CLIï¼šè‡ªåŠ¨ä¿å­˜å†å²  
â€¢ Claude Agent SDKï¼šæ˜¾å¼ç®¡ç†

**é›†æˆæ–¹å¼ï¼š**  
â€¢ Claude Code CLIï¼šIDE æ’ä»¶  
â€¢ Claude Agent SDKï¼šåº”ç”¨å†…åµŒå…¥

###  é…ç½®å…±äº«

ä¸¤è€…å¯ä»¥å…±äº«é…ç½®æ–‡ä»¶ï¼ˆCLAUDE.md å’Œ .claude/ ç›®å½•ï¼‰ï¼š

# åŠ è½½é¡¹ç›®çš„ CLAUDE.md é…ç½®  
options =  ClaudeAgentOptions  (  
system_prompt={  
"type"  :  "preset"  ,  
"preset"  :  "claude_code"  
},  
setting_sources=[  "project"  ]  # åŠ è½½ .claude/settings.json  
)  
---  

###  ä½¿ç”¨å»ºè®®

**ä½¿ç”¨ Claude Code CLIï¼š**

â€¢ äº¤äº’å¼å¼€å‘å’Œè°ƒè¯•

â€¢ ä¸€æ¬¡æ€§ä»»åŠ¡

â€¢ ä¸ä»£ç åº“è¿›è¡Œå¯¹è¯å¼å¼€å‘

â€¢ IDE é›†æˆå¼€å‘

**ä½¿ç”¨ Claude Agent SDKï¼š**

â€¢ CI/CD è‡ªåŠ¨åŒ–

â€¢ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

â€¢ é›†æˆåˆ°ç°æœ‰åº”ç”¨

â€¢ æ‰¹é‡å¤„ç†ä»»åŠ¡

â€¢ éœ€è¦ç²¾ç»†æƒé™æ§åˆ¶

###  å®Œæ•´å·¥ä½œæµç¤ºä¾‹

# å…¸å‹å·¥ä½œæµï¼šå¼€å‘ â†’ éªŒè¯ â†’ è‡ªåŠ¨åŒ–  

# ç¬¬ä¸€æ­¥ï¼šåœ¨ CLI ä¸­äº¤äº’å¼å¼€å‘  
# $ claude --prompt "åˆ›å»ºæ–°åŠŸèƒ½ X"  
# æ‰‹åŠ¨æµ‹è¯•ã€è°ƒæ•´ã€éªŒè¯  

# ç¬¬äºŒæ­¥ï¼šå°†éªŒè¯è¿‡çš„å·¥ä½œæµè½¬æ¢ä¸º SDK ä»£ç†  
async  def  deploy_feature_x  ():  
async  for  message  in  query  (  
prompt=  "æŒ‰ç…§æ—¢å®šæ¨¡å¼åˆ›å»ºåŠŸèƒ½ X"  ,  
options=  ClaudeAgentOptions  (  
allowed_tools=[  "Read"  ,  "Write"  ,  "Edit"  ,  "Bash"  ],  
permission_mode=  "acceptEdits"  ,  
setting_sources=[  "project"  ]  # ä½¿ç”¨é¡¹ç›®é…ç½®  
)  
):  
# åœ¨ CI/CD ä¸­è‡ªåŠ¨è¿è¡Œ  
handle_message  (message)  
---  

##  > 07\.  å¸¸è§é—®é¢˜

###  Q1: Claude Agent SDK éœ€è¦å®‰è£… Claude Code å—ï¼Ÿ

æ˜¯çš„ã€‚Claude Agent SDK ä¾èµ– Claude Code CLI ä½œä¸ºè¿è¡Œæ—¶ç¯å¢ƒã€‚ä½ éœ€è¦å…ˆå®‰è£… Claude Codeã€‚

###  Q2: å¦‚ä½•æ§åˆ¶æˆæœ¬ï¼Ÿ

â€¢ ä½¿ç”¨  max_turns  é™åˆ¶æœ€å¤§è½®æ¬¡

â€¢ é€šè¿‡  allowed_tools  é™åˆ¶å¯ç”¨å·¥å…·

â€¢ ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆé€šè¿‡ model å‚æ•°ï¼‰

â€¢ è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

###  Q3: å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å—ï¼Ÿ

å®Œå…¨å¯ä»¥ï¼ä½†éœ€è¦æ³¨æ„ï¼š

â€¢ å®ç°å®Œå–„çš„é”™è¯¯å¤„ç†

â€¢ ä½¿ç”¨æƒé™ç³»ç»Ÿé™åˆ¶å·¥å…·è®¿é—®

â€¢ æ·»åŠ å®¡è®¡æ—¥å¿—

â€¢ è®¾ç½®è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

â€¢ åœ¨æ²™ç®±ç¯å¢ƒä¸­è¿è¡Œæ•æ„Ÿæ“ä½œ

###  Q4: å¦‚ä½•è°ƒè¯•æ™ºèƒ½ä½“ï¼Ÿ

# æ‰“å°æ‰€æœ‰æ¶ˆæ¯  
async  for  message  in  query  (prompt=  "..."  ):  
print  (  f"æ¶ˆæ¯ç±»å‹ï¼š  {  message.type  }  "  )  
print  (  f"æ¶ˆæ¯å†…å®¹ï¼š  {  message  }  "  )  

# ä½¿ç”¨ Hooks è®°å½•å·¥å…·è°ƒç”¨  
async  def  debug_hook  (input_data, tool_use_id, context):  
print  (  f"å·¥å…·è°ƒç”¨ï¼š  {  input_data[  'tool_name'  ]  }  "  )  
print  (  f"å‚æ•°ï¼š  {  input_data[  'tool_input'  ]  }  "  )  
return  {}  
---  

##  > 08\.  æ€»ç»“

Claude Agent SDK ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„æ¡†æ¶ï¼Œè®© AI æ™ºèƒ½ä½“èƒ½å¤ŸçœŸæ­£èµ°è¿›ç”Ÿäº§ç¯å¢ƒã€‚é€šè¿‡ï¼š

â€¢ **ä¸°å¯Œçš„å†…ç½®å·¥å…·** ï¼šè¦†ç›–æ–‡ä»¶æ“ä½œã€å‘½ä»¤æ‰§è¡Œã€ç½‘ç»œæœç´¢ç­‰å¸¸è§éœ€æ±‚

â€¢ **å¼ºå¤§çš„æƒé™ç³»ç»Ÿ** ï¼šç¡®ä¿å®‰å…¨å¯æ§çš„è‡ªåŠ¨åŒ–

â€¢ **çµæ´»çš„ Hooks æœºåˆ¶** ï¼šåœ¨å…³é”®ç‚¹æ’å…¥è‡ªå®šä¹‰é€»è¾‘

â€¢ **ä¼šè¯ç®¡ç†** ï¼šç»´æŠ¤æŒç»­çš„å¯¹è¯ä¸Šä¸‹æ–‡

â€¢ **MCP é›†æˆ** ï¼šæ‰©å±•è‡ªå®šä¹‰å·¥å…·

æ— è®ºæ˜¯æ„å»º CI/CD è‡ªåŠ¨åŒ–ã€ä»£ç å®¡æŸ¥ç³»ç»Ÿï¼Œè¿˜æ˜¯æ™ºèƒ½å¼€å‘åŠ©æ‰‹ï¼ŒClaude Agent SDK éƒ½èƒ½æä¾›åšå®çš„åŸºç¡€ã€‚

ç°åœ¨å°±å¼€å§‹ä½ çš„ AI æ™ºèƒ½ä½“ä¹‹æ—…å§ï¼

ğŸ”— å‚è€ƒèµ„æºï¼š

å®˜æ–¹æ–‡æ¡£ï¼š  https://docs.anthropic.com/en/docs/agents

GitHub ä»“åº“ï¼š  https://github.com/anthropics/anthropic-sdk-typescript

Claude API æ§åˆ¶å°ï¼š  https://console.anthropic.com/

ç¤¾åŒºè®¨è®ºï¼š  https://github.com/anthropics/claude-code/discussions

ğŸ“– å¾€æœŸå†…å®¹ï¼š

[ ä»70åˆ†é’Ÿåˆ°9åˆ†é’Ÿï¼šå¾®ä¿¡å…¬ä¼—å·è‡ªåŠ¨åŒ–Skillsï¼ææ•ˆç‹‚é­”ï¼](https://mp.weixin.qq.com/s?__biz=MzYzNDU0OTE5Nw==&mid=2247484628&idx=1&sn=db1ccd7bf7a243dd13ad77785f04f7a9&scene=21#wechat_redirect)

[ Claude Skillï¼šä¸ºä»€ä¹ˆå®ƒä¼šå–ä»£ Difyã€n8n å’Œ Cozeï¼Ÿ](https://mp.weixin.qq.com/s?__biz=MzYzNDU0OTE5Nw==&mid=2247484218&idx=1&sn=64d4bf66c2a66d1d45be208c02e44a3d&scene=21#wechat_redirect)  

[ Claude Skills:è®©AIåŠ©æ‰‹ç§’å˜é¢†åŸŸä¸“å®¶çš„"æŠ€èƒ½åŒ…"ç³»ç»Ÿ](https://mp.weixin.qq.com/s?__biz=MzYzNDU0OTE5Nw==&mid=2247483729&idx=1&sn=b622701e7ab1c8c27424d71b254a16b8&scene=21#wechat_redirect)

[ å›½äº§AIç¼–ç¨‹åŒé›„å¯¹å†³ï¼šMiniMax 2.1 vs æ™ºè°±GLM-4.7ï¼Œè°æ›´é€‚åˆä½ ï¼Ÿ](https://mp.weixin.qq.com/s?__biz=MzYzNDU0OTE5Nw==&mid=2247483701&idx=1&sn=420c5741ce56f6d2fdc36b71c057436e&scene=21#wechat_redirect)

[ Google å¼€æº A2UIï¼šè®© AI æ™ºèƒ½ä½“ä¼š"è¯´"UI çš„é©å‘½æ€§åè®®](https://mp.weixin.qq.com/s?__biz=MzYzNDU0OTE5Nw==&mid=2247483964&idx=1&sn=b2d26325dad972670e2ed4c7f34e843f&scene=21#wechat_redirect)
